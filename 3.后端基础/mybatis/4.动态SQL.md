# 动态 SQL

随着用户的输入或外部条件的变化而变化的 SQL 语句

## 1.\<if> 标签

用于判断条件是否成立。使用 test 属性进行条件判断，如果条件为 true，则拼接 SQL。

```xml
<select id="list" resultType="com.gdj.mybatis2.bean.User">
    select * from users
    <where>
        <if test="name != null">
            name like '%${name}%'
        </if>
        <if test="age != null">
            and age >= #{age}
        </if>
        <if test="deptName != null">
            and dept_name like '%${deptName}%'
        </if>
        <if test="startTime != null and endTime != null">
            and create_time between #{startTime} and #{endTime}
        </if>
    </where>
    order by id desc
</select>

<update id="update">
    update users
    <set>
        <if test="name != null">name = #{name},</if>
        <if test="age != null">age = #{age}</if>
    </set>
    where id = #{id}
</update>
```

1. \<where> 标签

where 元素只会在子元素有内容的情况下才插入 where 子句。而且会自动去除子句的开头的 AND 或 OR。

2. \<set> 标签

动态的在行首插入 set 关键字,并会删除掉额外的逗号(update 语句中)

## 2.\<foreach> 标签

- collection: 遍历的集合
- item: 遍历出来的元素
- separator: 分隔符
- open: 遍历开始前拼接的 SQL 片段
- close: 遍历结束后拼接的 SQL 片段

```java
// 批量删除员工
public void deleteByIds(List<Integer> ids);
```

```sql
delete from users where id in (1,2);
```

```xml
<delete id="deleteByIds">
    delete from users where id in
    <foreach collection="ids" item="id" separator="," open="(" close=")">
        #{id}
    </foreach>
</delete>
```

## 3.\<sql><include>标签

- sql: 定义可重用的 SQL 片段
- include: 通过属性 refid,指定包含的 SQL 片段

```java
public User getById(Integer id);
```

```xml
<sql id="commonSelectUsers">
    select id,name,age,users.dept_name,create_time from users
</sql>

<select id="getById" resultType="com.gdj.mybatis2.bean.User">
    <include refid="commonSelectUsers"></include>
    where id = #{id}
</select>
```
